
# üõ°Ô∏è –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å Access/Refresh Token –∏ CAPTCHA

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å—Ö–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ JWT –∏ Redis:

- **Access Token** ‚Äî –∂–∏–≤—ë—Ç –Ω–µ–¥–æ–ª–≥–æ (30 –º–∏–Ω—É—Ç) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º.
   - –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è stateless-—Å–ø–æ—Å–æ–±–æ–º: –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —á–∞—Å—Ç–æ–≥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è, —É–ª—É—á—à–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç UX (–≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–∏ –∏ —Ä–µ–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º).

- **Refresh Token** ‚Äî –∂–∏–≤—ë—Ç –¥–æ–ª–≥–æ (–¥–æ 30 –¥–Ω–µ–π), —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **Redis**, –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Å—Å–∏—é –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞.
   - –ü—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –∏–ª–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

- **CAPTCHA** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
   - –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–æ—Ç–æ–≤.
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∞–µ—Ç CAPTCHA ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º.
   - –¢–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏).

---

### üîÅ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—É—á–∏—Ç—å CAPTCHA**  
   `GET /api/v1/captcha` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ `captchaId`.

2. **–†–µ—à–∏—Ç—å CAPTCHA**  
   `POST /api/v1/captcha/solve` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π `captchaToken` (—Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ ‚Äî 2 –º–∏–Ω—É—Ç—ã).

3. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è**  
   `POST /api/v1/auth/register` —Å `captchaToken` –≤ —Ç–µ–ª–µ ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç.

4. **–í–æ–π—Ç–∏**  
   `POST /api/v1/auth/login` ‚Üí –≤—ã–¥–∞—é—Ç—Å—è `accessToken` –∏ `refreshToken`.

5. **–†–∞–±–æ—Ç–∞—Ç—å —Å API**  
   –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:  
   `Authorization: Bearer <accessToken>`

6. **–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é**  
   –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è `accessToken` ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `refreshToken` –Ω–∞ `/api/v1/auth/refresh` ‚Üí –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—É—é –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤.

7. **–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã**  
   `POST /api/v1/auth/logout` ‚Üí `refreshToken` —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ Redis.  
   (Access token –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è stateless JWT.)

---

### ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Spring Boot 3.5+**, **Spring Security**
- **JWT** (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `jjwt`) ‚Äî –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ access token
- **Redis** ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è refresh token –∏ CAPTCHA-–¥–∞–Ω–Ω—ã—Ö (—Å TTL –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π)
- **Kaptcha** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π CAPTCHA
- **Lombok** –∏ **record-–∫–ª–∞—Å—Å—ã** ‚Äî –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

---

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ**:  
  –∫–æ—Ä–æ—Ç–∫–∏–π access token, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è CAPTCHA –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, refresh token —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Redis —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- üîÑ **–£–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:  
  –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è.
- üßπ **–ß–∏—Å—Ç–∞—è –ø–∞–º—è—Ç—å**:  
  –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ Redis —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ TTL –∏–ª–∏ –ø—Ä–∏ logout ‚Äî –Ω–µ—Ç —É—Ç–µ—á–µ–∫.
- üì¶ **–ì–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é**:  
  stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Redis) –ø–æ–∑–≤–æ–ª—è—é—Ç –ª–µ–≥–∫–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤.
- üåê **–°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏**:  
  —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **Spring Cloud Gateway**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Redis Cluster**.

---

‚úâ **–ö–æ–Ω—Ç–∞–∫—Ç—ã**: [krp77@mail.ru](mailto:krp77@mail.ru)

--- 

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ README, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–º –æ–ø–∏—Å–∞–Ω–∏–∏.