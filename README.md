
# üõ°Ô∏è –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å Access/Refresh Token –∏ CAPTCHA

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å—Ö–µ–º—É –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

- **Access Token** ‚Äî –∂–∏–≤—ë—Ç –Ω–µ–¥–æ–ª–≥–æ (30 –º–∏–Ω—É—Ç) –∏ –Ω—É–∂–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º API. 
- Access Token:‚Äî –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î.‚Äî –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—É—Ç—ë–º –ø–∞—Ä—Å–∏–Ω–≥–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è.
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω ‚Äî –µ–≥–æ –ø–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞ –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –∏—Å—Ç—ë–∫. 
- –ë–ª–∞–≥–æ–¥–∞—Ä—è –µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç ‚Äî —ç—Ç–æ —É–ª—É—á—à–∞–µ—Ç UX (–≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–∏ –∏ —Ä–µ–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º).

- **Refresh Token** ‚Äî –∂–∏–≤—ë—Ç –¥–æ–ª–≥–æ (–¥–æ 30 –¥–Ω–µ–π), —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **Redis**, –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Å—Å–∏—é –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞**.  


- **CAPTCHA** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.  
  –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –±–æ—Ç–æ–≤: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∞–µ—Ç –∫–∞–ø—á—É, –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω, –∏ —Ç–æ–ª—å–∫–æ —Å –Ω–∏–º –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.

---

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—É—á–∏—Ç—å CAPTCHA**  
   `GET /api/v1/captcha` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ `captchaId`.

2. **–†–µ—à–∏—Ç—å CAPTCHA**  
   `POST /api/v1/captcha/solve` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `captchaToken`.

3. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è**  
   `POST /api/v1/auth/register` —Å `captchaToken` –≤ —Ç–µ–ª–µ ‚Üí —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç.

4. **–í–æ–π—Ç–∏**  
   `POST /api/v1/auth/login` ‚Üí –≤—ã–¥–∞—ë—Ç `accessToken` –∏ `refreshToken`.

5. **–†–∞–±–æ—Ç–∞—Ç—å —Å API**  
   –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º ‚Äî —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º:  
   `Authorization: Bearer <accessToken>`

6. **–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é**  
   –ö–æ–≥–¥–∞ `accessToken` –∏—Å—Ç—ë–∫ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `refreshToken` –Ω–∞ `/refresh` ‚Üí –≤—ã–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –ø–∞—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤.

7. **–í—ã–π—Ç–∏**  
   `POST /api/v1/auth/logout` ‚Üí —É–¥–∞–ª—è–µ—Ç `refreshToken` –∏–∑ Redis.

---

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Spring Boot 3.5+**, **Spring Security**
- **JWT** (—á–µ—Ä–µ–∑ `jjwt`) ‚Äî –¥–ª—è access token
- **Redis** ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è refresh token –∏ CAPTCHA-–¥–∞–Ω–Ω—ã—Ö
- **Kaptcha** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è CAPTCHA-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **Lombok** –∏ **record-–∫–ª–∞—Å—Å—ã** ‚Äî –º–µ–Ω—å—à–µ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

---

### –ü–ª—é—Å—ã

- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ**: –∫–æ—Ä–æ—Ç–∫–∏–π access token, –ø—Ä–æ–≤–µ—Ä–∫–∞ CAPTCHA, —Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh token –≤ Redis.
- üîÑ **–£–¥–æ–±–Ω–æ**: –Ω–µ –Ω—É–∂–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ ‚Äî —Å–µ—Å—Å–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- üßπ **–ß–∏—Å—Ç–æ**: –Ω–µ—Ç –º—É—Å–æ—Ä–∞ –≤ Redis ‚Äî –≤—Å—ë —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ TTL –∏–ª–∏ –ø—Ä–∏ logout.
- üì¶ **–ì–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é**: Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—â–∏–π –±—ç–∫–µ–Ω–¥ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤.

---

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö.  
–°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å **Spring Cloud Gateway**, **Redis Cluster**.

---

‚úâ **–ö–æ–Ω—Ç–∞–∫—Ç—ã**: krp77@mail.ru